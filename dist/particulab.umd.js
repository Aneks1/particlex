(function(s,h){typeof exports=="object"&&typeof module<"u"?h(exports):typeof define=="function"&&define.amd?define(["exports"],h):(s=typeof globalThis<"u"?globalThis:s||self,h(s.particulab={}))})(this,function(s){"use strict";var H=Object.defineProperty;var b=(s,h,o)=>h in s?H(s,h,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[h]=o;var t=(s,h,o)=>b(s,typeof h!="symbol"?h+"":h,o);class h{constructor(i,e,a,n){t(this,"red");t(this,"green");t(this,"blue");t(this,"alpha");if(this.red=i,this.green=e,this.blue=a,this.alpha=n,i>255||i<0||e>255||e<0||a>255||a<0||n>1||n<0)throw new TypeError("Invalid rgba color.")}toHex(){const i=this._componentToHex(this.red),e=this._componentToHex(this.green),a=this._componentToHex(this.blue);return new o(`#${i}${e}${a}`)}_componentToHex(i){const e=i.toString(16);return e.length===1?"0"+e:e}toString(){return`rgba(${this.red}, ${this.green}, ${this.blue}, ${this.alpha})`}}class o{constructor(i){t(this,"hex");i[0]==="#"&&(i=i.slice(1)),i.length===3&&(i=i.split("").map(e=>e+e).join("")),this.hex=i}toRGB(){const i=parseInt(this.hex.slice(0,2),16),e=parseInt(this.hex.slice(2,4),16),a=parseInt(this.hex.slice(4,6),16);return new h(i,e,a,1)}toString(){return`#${this.hex}`}}class p{constructor(i,e){t(this,"parent");t(this,"options");t(this,"deltaSize",0);t(this,"deltaOpacity",0);if(e.opacity==null&&e.scaleFactor==null)throw new TypeError("Can not create a FadeHandler with opacity and scaleFactor both undefined .");this.parent=i,this.options=e}}class u extends p{constructor(i,e){super(i,e),this.calculateDeltas()}calculateDeltas(){this.options.opacity!=null&&(this.deltaOpacity=(this.options.opacity-this.parent.opacity)/this.options.duration),this.options.scaleFactor!=null&&(this.deltaSize=(this.options.scaleFactor*this.parent.size-this.parent.size)/this.options.duration)}}class m extends p{constructor(e,a){super(e,a);t(this,"initialLife");this.calculateDeltas(),this.initialLife=this.parent.life}calculateDeltas(){this.options.opacity!=null&&(this.deltaOpacity=(this.parent.opacity-this.options.opacity)/this.options.duration),this.options.scaleFactor!=null&&(this.deltaSize=(this.parent.size-this.options.scaleFactor*this.parent.size)/this.options.duration)}}class g{drawCircle(i,e){i.beginPath(),i.arc(e.position.x,e.position.y,e.size/2,0,2*Math.PI,!1),i.closePath(),i.fill()}drawRectangle(i,e){i.fillRect(e.position.x-e.size/2,e.position.y-e.size/2,e.size,e.size)}drawTriangle(i,e){const a=e.size*Math.sqrt(3)/2;i.beginPath(),i.moveTo(e.position.x,e.position.y-a/2),i.lineTo(e.position.x-e.size/2,e.position.y+a/2),i.lineTo(e.position.x+e.size/2,e.position.y+a/2),i.closePath(),i.fill()}drawStar(i,e){const n=e.size/2,f=n/2.5;let z=Math.PI/5;i.beginPath();for(let c=0;c<5*2;c++){let y=c%2===0?n:f,M=e.position.x+Math.cos(z*c)*y,F=e.position.y+Math.sin(z*c)*y;i.lineTo(M,F)}i.closePath(),i.fill()}drawImage(i,e,a){e.drawImage(i.element,a.position.x-a.size/2,a.position.y-a.size/2,a.size,a.size)}}class I{constructor(i,e,a){t(this,"parent");t(this,"id");t(this,"animationFramId");t(this,"lastUpdate",performance.now());t(this,"shapeManager",new g);t(this,"position",{x:0,y:0});t(this,"size",0);t(this,"life",0);t(this,"speed",{x:0,y:0});t(this,"color",new o("#ffffff"));t(this,"opacity",100);t(this,"shape","circle");t(this,"fadeOut");t(this,"fadeIn");t(this,"fadeOutHandler");t(this,"fadeInHandler");this.parent=e,this.id=i}init(){var i,e,a,n;this.fadeOut&&(this.fadeOut.opacity!=null||this.fadeOut.scaleFactor!=null)&&(this.fadeOutHandler=new u(this,this.fadeOut)),this.fadeIn&&(this.fadeIn.opacity!=null||this.fadeIn.scaleFactor!=null)&&(this.fadeInHandler=new m(this,this.fadeIn)),this.opacity=((i=this.fadeIn)==null?void 0:i.opacity)!=null?(e=this.fadeIn)==null?void 0:e.opacity:Math.max(0,Math.min(100,this.opacity)),this.size=((a=this.fadeIn)==null?void 0:a.scaleFactor)!=null?(n=this.fadeIn)==null?void 0:n.scaleFactor:Math.max(0,this.size),this.life=Math.max(0,this.life),this.update()}update(){var a,n,f;const i=performance.now(),e=(i-this.lastUpdate)/1e3;this.lastUpdate=i,this.position.x+=this.speed.x*e,this.position.y-=this.speed.y*e,this.fadeIn&&this.fadeInHandler&&this.life>=this.fadeInHandler.initialLife-this.fadeIn.duration&&(this.opacity+=((a=this.fadeInHandler)==null?void 0:a.deltaOpacity)*e,this.opacity=Math.max(0,Math.min(100,this.opacity)),this.size+=this.fadeInHandler.deltaSize*e,this.size=Math.max(0,this.size)),this.fadeOut&&this.fadeOutHandler&&this.life<=((n=this.fadeOut)==null?void 0:n.duration)&&(this.opacity+=((f=this.fadeOutHandler)==null?void 0:f.deltaOpacity)*e,this.opacity=Math.max(0,Math.min(100,this.opacity)),this.size+=this.fadeOutHandler.deltaSize*e,this.size=Math.max(0,this.size)),this.life-=1/60,this.life<=0&&this.delete(),this.animationFramId=requestAnimationFrame(this.update.bind(this))}delete(){cancelAnimationFrame(this.animationFramId),this.parent.particles.delete(this.id)}draw(i){switch(i.fillStyle=this.color.toString(),i.globalAlpha=this.opacity/100,this.shape){case"circle":this.shapeManager.drawCircle(i,{position:this.position,size:this.size});case"rectangle":this.shapeManager.drawRectangle(i,{position:this.position,size:this.size});case"triangle":this.shapeManager.drawTriangle(i,{position:this.position,size:this.size});case"star":this.shapeManager.drawStar(i,{position:this.position,size:this.size});default:this.shape.element?this.shapeManager.drawImage(this.shape,i,{position:this.position,size:this.size}):console.warn("Invalid shape "+this.shape)}}}function l(d,i){return{min:d,max:i}}class r{constructor(i,e){t(this,"canvas");t(this,"canvasSize");t(this,"lastId",0);t(this,"particles",new Map);t(this,"_ctx");t(this,"animationFramId");t(this,"amount");t(this,"life");t(this,"size");t(this,"speed");t(this,"colors");t(this,"opacity");t(this,"fadeOut");t(this,"fadeIn");t(this,"shapes");this.canvas=i,this.canvasSize=e.canvasSize,i.width=e.canvasSize.x,i.height=e.canvasSize.y,this._ctx=i.getContext("2d"),this.amount=e.amount||0,this.life=e.life||l(10,15),this.size=e.size||l(1,5),this.speed=e.speed||{x:l(-10,10),y:l(-10,10)},this.colors=e.colors||[],this.opacity=e.opacity||l(50,100),this.fadeOut=e.fadeOut,this.fadeIn=e.fadeIn,this.shapes=e.shapes||[]}static numberInRange(i){const e=Math.ceil(i.min),a=Math.floor(i.max);return Math.floor(Math.random()*(a-e+1))+e}static elementFromArray(i){const e=Math.floor(Math.random()*i.length);return i[e]}createParticle(){const i=new I(this.lastId.toString(),this);i.position.x=r.numberInRange({min:0,max:this.canvasSize.x}),i.position.y=r.numberInRange({min:0,max:this.canvasSize.y}),i.size=r.numberInRange(this.size),i.life=r.numberInRange(this.life),i.speed.x=r.numberInRange(this.speed.x),i.speed.y=r.numberInRange(this.speed.y),i.color=r.elementFromArray(this.colors)||new o("fff"),i.opacity=r.numberInRange(this.opacity),i.fadeOut=this.fadeOut,i.fadeIn=this.fadeIn,i.shape=r.elementFromArray(this.shapes)||"circle",i.init(),this.particles.set(this.lastId.toString(),i),this.lastId++}init(){for(let i=0;i<this.amount;i++)this.createParticle();this.update()}update(){var i;if(this.particles.size<this.amount)for(let e=this.particles.size;e<this.amount;e++)this.createParticle();(i=this._ctx)==null||i.clearRect(0,0,this.canvas.width,this.canvas.height);for(const[e,a]of this.particles)a.draw(this._ctx);this.animationFramId=requestAnimationFrame(this.update.bind(this))}stop(){cancelAnimationFrame(this.animationFramId)}clear(){var i;(i=this._ctx)==null||i.clearRect(0,0,this.canvas.width,this.canvas.height),this.particles=new Map}}class w{constructor(i){t(this,"src");t(this,"element");this.src=i,this.loadImage()}async loadImage(){try{this.element=await this.createImage(this.src)}catch(i){console.error(`Failed to load image: ${this.src}`,i)}}createImage(i){return new Promise((e,a)=>{const n=new Image;n.src=i,n.onload=()=>e(n),n.onerror=()=>a(new Error(`Image failed to load: ${i}`))})}}s.FadeHandler=p,s.FadeInHandler=m,s.FadeOutHandler=u,s.HEX=o,s.Particle=I,s.ParticleImage=w,s.ParticleSystem=r,s.RGBA=h,s.ShapeManager=g,s.range=l,Object.defineProperty(s,Symbol.toStringTag,{value:"Module"})});
